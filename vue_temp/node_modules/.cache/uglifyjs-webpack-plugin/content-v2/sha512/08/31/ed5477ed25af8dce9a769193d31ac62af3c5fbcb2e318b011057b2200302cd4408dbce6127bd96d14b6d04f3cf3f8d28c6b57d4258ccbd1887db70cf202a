{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[\"chunk-552a\"],{Alnb:function(e,t,s){},CzVE:function(e,t,s){\"use strict\";s.r(t);var n=s(\"P2sY\"),a=s.n(n),i=s(\"iD1z\"),r={name:\"ZeroDetail\",props:{values:{type:Object,require:!0,default:function(){return[]}}},data:function(){return{dialogTableVisible:!1,res_obj:{},check_res:!1,check_su:!1,check_content:\"\",form:{workname:\"\",db_name:\"\",instance:\"\",db_sql:\"\",active:0},instance_port:0,instance_id:{instance_id:0,page_size:100},instance_online:{online:!0},instance_list:[],database_list:[],check_dic:{instance_host:\"\",dbname:\"\",sql:\"\",execute:0},disabled:!1,rules:{workname:[{required:!0,message:\"请填写工单名称\",trigger:\"blur\"},{max:50,message:\"长度最大 50 个字符\",trigger:\"blur\"}],db_sql:[{required:!0,message:\"请输入SQL内容\",trigger:\"blur\"}],instance:[{required:!0,message:\"请选择实例名称\",trigger:\"change\"}],db_name:[{required:!0,message:\"请选择数据库名\",trigger:\"change\"}]}}},watch:{\"form.instance\":function(e,t){this.form.db_name=null}},created:function(){this.fetchInstance()},methods:{reset:function(){this.$refs.workform.resetFields(),this.check_res=!1},checkSql:function(){var e=this;this.check_dic.dbname=this.form.db_name,this.check_dic.execute=0,this.check_dic.instance_host=this.form.instance,this.check_dic.instance_port=this.database_list[0].instance_port,this.check_dic.sql=this.form.db_sql,!1===this.check_res&&Object(i.a)(this.check_dic).then(function(t){for(e.check_res in e.check_content=t,t)if(t[e.check_res].errlevel>0){e.check_res=!1,e.dialogTableVisible=!0;break}!1===e.dialogTableVisible&&e.$message({showClose:!0,message:\"恭喜你，SQL审核成功，请点击下一步。\",type:\"success\"})})},fetchDatabase:function(e){var t=this;this.instance_id.instance_id=e,Object(i.d)(this.instance_id).then(function(e){t.database_list=e.results})},fetchInstance:function(){var e=this;Object(i.e)(this.instance_online).then(function(t){e.instance_list=t.results,e.form.db_name=\"\"})},next:function(){this.form.active++,this.form.db_port=this.database_list[0].instance_port,this.res_obj=a()(this.values,this.form),this.$emit(\"closeMain\",this.res_obj)}}},o=(s(\"cHSD\"),s(\"KHd+\")),c=Object(o.a)(r,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"admin-container\"},[s(\"el-form\",{ref:\"workform\",attrs:{model:e.form,rules:e.rules,\"label-width\":\"100px\"},on:{click:e.fetchInstance}},[s(\"el-form-item\",{staticStyle:{width:\"40%\"},attrs:{label:\"工单名称\",prop:\"workname\",placeholder:\"请输入工单名称\"}},[s(\"el-input\",{attrs:{maxlength:\"50\"},model:{value:e.form.workname,callback:function(t){e.$set(e.form,\"workname\",t)},expression:\"form.workname\"}},[s(\"template\",{slot:\"prepend\"},[e._v(\"SQL工单-\")])],2)],1),e._v(\" \"),s(\"el-form-item\",{staticStyle:{width:\"40%\"},attrs:{label:\"选择实例\",prop:\"instance\"}},[s(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{disabled:!1!==e.check_res||e.disabled,filterable:\"\",placeholder:\"请选择\",clearable:\"\"},model:{value:e.form.instance,callback:function(t){e.$set(e.form,\"instance\",t)},expression:\"form.instance\"}},e._l(e.instance_list,function(t){return s(\"el-option\",{key:t.instance_host,attrs:{label:t.instance_name,value:t.instance_host},nativeOn:{click:function(s){e.fetchDatabase(t.id)}}},[s(\"span\",{staticStyle:{float:\"left\"},attrs:{instance_port:t.instance_port}},[e._v(e._s(t.instance_name))]),e._v(\" \"),s(\"span\",{staticStyle:{float:\"right\",color:\"#8492a6\",\"font-size\":\"13px\"}},[e._v(e._s(t.instance_host))])])}))],1),e._v(\" \"),s(\"el-form-item\",{staticStyle:{width:\"40%\"},attrs:{label:\"选择库名\",prop:\"db_name\"}},[s(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{disabled:!1!==e.check_res||e.disabled,filterable:\"\",placeholder:\"请选择\"},model:{value:e.form.db_name,callback:function(t){e.$set(e.form,\"db_name\",t)},expression:\"form.db_name\"}},e._l(e.database_list,function(e){return s(\"el-option\",{key:e.db_name,attrs:{label:e.db_name,value:e.db_name}})}))],1),e._v(\" \"),s(\"el-form-item\",{staticStyle:{width:\"60%\"},attrs:{label:\"SQL内容\",prop:\"db_sql\"}},[s(\"el-input\",{attrs:{rows:10,disabled:!1!==e.check_res||e.disabled,type:\"textarea\",placeholder:\"请输入SQL\"},model:{value:e.form.db_sql,callback:function(t){e.$set(e.form,\"db_sql\",t)},expression:\"form.db_sql\"}},[e._v(e._s(e.form.name))])],1)],1),e._v(\" \"),s(\"div\",{staticClass:\"app-container\"},[s(\"el-dialog\",{attrs:{visible:e.dialogTableVisible,title:\"SQL自动审核结果\",align:\"left\"},on:{\"update:visible\":function(t){e.dialogTableVisible=t}}},[e.check_res<1?s(\"div\",{staticStyle:{color:\"blue\"}},[e._v('#--[Mysql Error 2576 ......]，\"语法问题/结尾没有冒号/有中文符号\" 所导致，请仔细检查语法。 ')]):e._e(),e._v(\" \"),s(\"div\",[s(\"hr\")]),e._v(\" \"),s(\"ul\",e._l(e.check_content,function(t){return t.errlevel>0?s(\"li\",{key:t.ID},[s(\"p\",{staticStyle:{color:\"green\"}},[e._v(\"ID: \"+e._s(t.ID))]),e._v(\" \"),s(\"p\",[e._v(\"Stage: \"+e._s(t.stage))]),e._v(\" \"),s(\"p\",[e._v(\"ErrLevel: \"+e._s(t.errlevel))]),e._v(\" \"),s(\"p\",[e._v(\"StageStatus: \"+e._s(t.stagestatus))]),e._v(\" \"),s(\"div\",[s(\"div\",{staticStyle:{color:\"blue\"}},[e._v(\"ErrorMessage【请按照红字提示信息进行修改】:\")]),e._v(\" \"),s(\"div\",{staticStyle:{color:\"red\"},domProps:{innerHTML:e._s(t.errormessage)}},[e._v(\".\")])]),e._v(\" \"),s(\"br\"),e._v(\" \"),s(\"div\",[s(\"div\",{staticStyle:{color:\"blue\"}},[e._v(\"SQL语句:\")]),e._v(\" \"),s(\"div\",{domProps:{innerHTML:e._s(t.SQL.replace(/\\n/g,\"<br/>\"))}},[e._v(\".\")])]),e._v(\" \"),s(\"p\",[e._v(\"AffectedRows: \"+e._s(t.Affected_rows))]),e._v(\" \"),s(\"p\",[e._v(\"Sequence: \"+e._s(t.sequence))]),e._v(\" \"),s(\"p\",[e._v(\"Backup_Dbname: \"+e._s(t.backup_dbname))]),e._v(\" \"),s(\"p\",[e._v(\"Execute_Time: \"+e._s(t.execute_time))]),e._v(\" \"),s(\"p\",[e._v(\"SqlSha1: \"+e._s(t.sqlsha1))])]):e._e()})),e._v(\" \"),s(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[s(\"el-button\",{attrs:{type:\"info\"},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v(\"Close\")])],1)]),e._v(\" \"),s(\"div\",{staticClass:\"filter-container\"},[s(\"router-link\",{attrs:{to:\"/task/create/\"}},[e.check_res>=1?s(\"el-button\",{attrs:{type:\"info\"},on:{click:e.reset}},[e._v(\"重新填\")]):e._e()],1),e._v(\" \"),!(\"\"===e.form.db_sql||\"\"===e.form.workname||\"\"===e.form.db_name||\"\"===e.form.instance||e.check_res>=1)||e.disabled?s(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.checkSql}},[e._v(\"Check\")]):e._e(),e._v(\" \"),\"\"!==e.form.workname&&!1!==e.check_res||e.disabled?s(\"el-button\",{attrs:{type:\"success\"},on:{click:e.next}},[e._v(\"下一步\")]):e._e()],1)],1)],1)},[],!1,null,\"48307212\",null);c.options.__file=\"zeroform.vue\";var l=c.exports,u=s(\"JhLU\"),_={name:\"OneDetail\",props:{values:{type:Object,require:!0,default:function(){return[]}}},data:function(){return{auditer_list:[],res_obj:{},disabled:!1,form:{auditor:\"\"},rules:{auditor:[{required:!0,message:\"请选择审批人\",trigger:\"change\"}]}}},methods:{fetchUserData:function(){var e=this;Object(u.b)(this.listQuery).then(function(t){e.auditer_list=t})},next:function(){this.values.active++,this.res_obj=a()(this.values,this.form),this.$emit(\"closeMain\",this.res_obj)},prev:function(){this.values.active--,this.$emit(\"closeMain\",this.values)}}},d=(s(\"VoZR\"),Object(o.a)(_,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"app-main\",attrs:{align:\"center\"}},[s(\"el-form\",{ref:\"sform\",attrs:{model:e.form,rules:e.rules,inline:!0}},[s(\"el-form-item\",{attrs:{label:\"选择审批人员:\",prop:\"auditer\"}},[s(\"el-select\",{attrs:{filterable:\"\",placeholder:\"可直接搜索审批人\",clearable:\"\"},nativeOn:{click:function(t){e.fetchUserData()}},model:{value:e.form.auditor,callback:function(t){e.$set(e.form,\"auditor\",t)},expression:\"form.auditor\"}},e._l(e.auditer_list,function(t){return!0===t.is_staff?s(\"el-option\",{key:t.username,attrs:{label:t.username,value:t.username}}):e._e()}))],1)],1),e._v(\" \"),s(\"div\",{staticClass:\"dialog-footer\",attrs:{slot:\"footer\"},slot:\"footer\"},[s(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.prev}},[e._v(\"上一步\")]),e._v(\" \"),\"\"!==e.form.auditor||e.disabled?s(\"el-button\",{attrs:{type:\"success\"},on:{click:e.next}},[e._v(\"下一步\")]):e._e()],1)],1)},[],!1,null,\"00de61cc\",null));d.options.__file=\"oneform.vue\";var f=d.exports,m=s(\"fe1z\"),v=s(\"d5rn\"),b={name:\"TwoDetail\",props:{values:{type:Object,require:!0,default:function(){return[]}}},data:function(){return{sql_content:\"\",res_obj:{},form:{author:\"\"}}},created:function(){this.userInfo()},methods:{prev:function(){this.values.active--,this.$emit(\"closeMain\",this.values)},userInfo:function(){var e=this;Object(m.a)().then(function(t){e.form.author=t.name,e.res_obj=a()(e.values,e.form),e.res_obj.work_id=parseInt(Math.round((new Date).getTime()/1e3).toString()),e.res_obj.db_sql=e.res_obj.db_sql.replace(/\\n/g,\"<br/>\")})},sub:function(){var e=this;delete this.res_obj.active,Object(v.a)(this.res_obj).then(function(t){e.$notify({title:\"成功\",message:\"创建成功\",type:\"success\",duration:2e3})})}}},h=(s(\"Gklq\"),Object(o.a)(b,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"app-container\",attrs:{align:\"center\"}},[s(\"el-card\",{staticClass:\"box-card\",staticStyle:{width:\"60%\"}},[s(\"div\",{staticClass:\"clearfix\",attrs:{slot:\"header\"},slot:\"header\"},[s(\"span\",{staticStyle:{color:\"green\"}},[e._v(\"请确认提交的内容\")])]),e._v(\" \"),s(\"div\",{staticClass:\"text item\",attrs:{align:\"left\"}},[s(\"div\",{staticClass:\"app-container\"},[e._v(\" 工单ID: \"+e._s(e.res_obj.work_id))]),e._v(\" \"),s(\"div\",{staticClass:\"app-container\"},[e._v(\" 工单名称: \"+e._s(e.res_obj.workname))]),e._v(\" \"),s(\"div\",{staticClass:\"app-container\"},[e._v(\" 数据库名: \"+e._s(e.res_obj.db_name))]),e._v(\" \"),s(\"div\",{staticClass:\"app-container\"},[e._v(\"\\n        执行语句:\\n        \"),s(\"div\",{staticClass:\"app-container\",domProps:{innerHTML:e._s(e.res_obj.db_sql)}},[e._v(\".\")])])])]),e._v(\" \"),s(\"div\",{staticClass:\"app-container\"},[s(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.prev}},[e._v(\"上一步\")]),e._v(\" \"),s(\"router-link\",{attrs:{to:\"/task/mytask/\"}},[s(\"el-button\",{attrs:{type:\"success\"},on:{click:function(t){e.sub()}}},[e._v(\"提交\")])],1)],1)],1)},[],!1,null,\"69811d7c\",null));h.options.__file=\"twoform.vue\";var p={name:\"Create\",components:{ZeroDetail:l,OneDetail:f,TwoDetail:h.exports},data:function(){return{form:{active:0}}},methods:{closeMain:function(e){this.form=e},prev:function(){this.active--<0&&(this.active=0)},next:function(){this.active++>2&&(this.active=0)}}},k=Object(o.a)(p,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"app-container\",attrs:{align:\"center\"}},[s(\"el-steps\",{attrs:{active:e.form.active,\"finish-status\":\"success\",\"process-status\":\"finish\",\"align-center\":\"\"}},[s(\"el-step\",{attrs:{title:\"填写工单\",description:\" \",icon:\"el-icon-edit\"}}),e._v(\" \"),s(\"el-step\",{attrs:{title:\"审批\",description:\"请选择审批人，将会以邮件方式通知审批人。\",icon:\"el-icon-view\"}}),e._v(\" \"),s(\"el-step\",{attrs:{title:\"提交\",description:\"请认真检查填写的相关信息，确认无误后点击提交，提交后可在工单列表中查看工单状态。\",icon:\"el-icon-upload\"}})],1),e._v(\" \"),0===e.form.active?s(\"zero-detail\",{attrs:{values:e.form},on:{closeMain:e.closeMain}}):e._e(),e._v(\" \"),1===e.form.active?s(\"one-detail\",{attrs:{values:e.form},on:{closeMain:e.closeMain}}):e._e(),e._v(\" \"),2===e.form.active?s(\"two-detail\",{attrs:{values:e.form},on:{closeMain:e.closeMain}}):e._e()],1)},[],!1,null,null,null);k.options.__file=\"create.vue\";t.default=k.exports},Gklq:function(e,t,s){\"use strict\";var n=s(\"Alnb\");s.n(n).a},JhLU:function(e,t,s){\"use strict\";s.d(t,\"b\",function(){return a}),s.d(t,\"a\",function(){return i});var n=s(\"t3Un\");function a(e){return Object(n.a)({url:\"/user/userinfo/\",method:\"get\",params:e})}function i(e){return Object(n.a)({url:\"/perms/roleinfo/0/\",method:\"put\",data:e})}},VoZR:function(e,t,s){\"use strict\";var n=s(\"lmYm\");s.n(n).a},cHSD:function(e,t,s){\"use strict\";var n=s(\"yGmH\");s.n(n).a},d5rn:function(e,t,s){\"use strict\";s.d(t,\"c\",function(){return a}),s.d(t,\"a\",function(){return i}),s.d(t,\"d\",function(){return r}),s.d(t,\"b\",function(){return o});var n=s(\"t3Un\");function a(e,t){return Object(n.a)({url:\"/workorder/workinfo/\",method:\"get\",params:e})}function i(e){return Object(n.a)({url:\"/workorder/workinfo/\",method:\"post\",data:e})}function r(e,t){return Object(n.a)({url:\"/workorder/workinfo/\"+e+\"/\",method:\"put\",data:t})}function o(e,t){return Object(n.a)({url:\"/workorder/executeres/\",method:\"get\",params:e})}},iD1z:function(e,t,s){\"use strict\";s.d(t,\"e\",function(){return a}),s.d(t,\"b\",function(){return i}),s.d(t,\"c\",function(){return r}),s.d(t,\"d\",function(){return o}),s.d(t,\"a\",function(){return c});var n=s(\"t3Un\");function a(e,t){return Object(n.a)({url:\"/instance/instanceinfo/\",method:\"get\",params:e})}function i(e){return Object(n.a)({url:\"/instance/instanceinfo/\",method:\"post\",data:e})}function r(e){return Object(n.a)({url:\"/instance/instanceinfo/\"+e,method:\"delete\"})}function o(e){return Object(n.a)({url:\"/instance/databaseinfo/\",method:\"get\",params:e})}function c(e){return Object(n.a)({url:\"/instance/checkmysql/\",method:\"get\",params:e})}},lmYm:function(e,t,s){},yGmH:function(e,t,s){}}]);","extractedComments":[]}